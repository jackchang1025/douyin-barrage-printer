# 开发模式自动 Mock 说明

## ✨ 新的开发体验

现在开发环境**自动使用模拟数据**，无需真实服务端！

### 🎯 设计理念

- ✅ **开发环境** - 自动 mock 所有 API，返回模拟数据
- 🌐 **生产环境** - 调用真实的服务端 API
- 🔄 **自动切换** - 根据 `import.meta.env.DEV` 自动判断

---

## 🚀 如何使用

### 1. 启动开发服务器

```bash
npm run electron:dev
```

### 2. 登录应用

在登录页面：

- **输入任意邮箱**（例如：`test@example.com`）
- **输入任意密码**（例如：`123456`）
- **点击登录**

就这么简单！✨

### 3. 自动体验

登录后会自动：
- ✅ 模拟登录成功（0.5秒延迟）
- ✅ 生成用户信息（邮箱前缀作为用户名）
- ✅ 设置 Pro 套餐（365天有效期）
- ✅ 加载 5 条模拟弹幕数据
- ✅ 显示统计信息

---

## 📊 模拟数据详情

### 用户信息
```json
{
  "id": 1,
  "name": "test",  // 从邮箱提取
  "email": "test@example.com",
  "plan": "pro",
  "subscription_expiry": "2026-11-27"  // 一年后
}
```

### 订阅信息
```json
{
  "active": true,
  "plan": "pro",
  "expiry_date": "2026-11-27",
  "days_remaining": 365,
  "features": {
    "daily_print_limit": -1,  // 无限制
    "filters": true,
    "custom_template": true,
    "api_access": true
  }
}
```

### 弹幕数据（5条）

| 用户 | 内容 | 类型 | 状态 |
|------|------|------|------|
| 测试用户1 | 666！主播太厉害了 | 文本 | 已打印 |
| 测试用户2 | 送出了嘉年华 | 礼物 | 已打印 |
| 测试用户3 | 关注了主播 | 关注 | 未打印 |
| 测试用户4 | 这个好看！ | 文本 | 未打印 |
| 测试用户5 | 送出了火箭 | 礼物 | 已打印 |

---

## 🔍 技术实现

### 环境检测

使用 Vite 内置的环境变量：

```typescript
if (import.meta.env.DEV) {
  // 开发环境：使用模拟数据
} else {
  // 生产环境：调用真实 API
}
```

### 自动 Mock 的 API

#### 1. 登录 API
```typescript
// src/stores/auth.ts - login()
if (import.meta.env.DEV) {
  // 返回模拟 token 和用户信息
  return mockLoginData
}
// 否则调用真实 API
```

#### 2. 注册 API
```typescript
// src/stores/auth.ts - register()
if (import.meta.env.DEV) {
  // 模拟注册成功
  return { success: true }
}
```

#### 3. 订阅检查 API
```typescript
// src/stores/auth.ts - checkSubscription()
if (import.meta.env.DEV) {
  // 返回模拟订阅数据（Pro 套餐）
  return mockSubscriptionData
}
```

#### 4. 弹幕数据加载
```typescript
// src/views/Dashboard.vue - onMounted()
if (import.meta.env.DEV) {
  // 加载模拟弹幕数据
  await barrageStore.initMockData()
}
```

---

## 🎨 UI 改进

### 开发环境提示

登录页顶部会显示蓝色提示框：

```
ℹ️ 开发模式
当前为开发环境，无需真实账号，直接输入任意邮箱密码即可登录（使用模拟数据）
```

### 控制台日志

开发模式下会有友好的日志输出：

```
🚀 开发模式：使用模拟登录数据
🚀 开发模式：加载模拟弹幕数据
🚀 开发模式：使用模拟订阅数据
```

---

## ✅ 优势

### 相比之前的"离线模式"按钮

| 方面 | 之前（离线模式按钮） | 现在（自动 Mock） |
|------|---------------------|------------------|
| **使用方式** | 需要点击"离线模式"按钮 | 自动启用，无需额外操作 |
| **用户体验** | 多一个步骤，容易混淆 | 完全透明，就像真实登录 |
| **代码复杂度** | 需要特殊判断逻辑 | 统一的代码路径 |
| **维护成本** | 两套逻辑分支 | 环境自动切换 |
| **测试体验** | 需要记住特殊操作 | 正常登录即可 |

### 开发优势

✅ **简单** - 直接输入任意账号密码即可  
✅ **自然** - 体验与真实环境一致  
✅ **透明** - 开发者无需关心是否在 mock  
✅ **灵活** - 轻松修改模拟数据  
✅ **安全** - 生产环境自动切换真实 API  

---

## 🔧 配置说明

### 修改模拟数据

如果需要修改模拟的用户信息：

```typescript
// src/stores/auth.ts - login()
const mockResponse = {
  token: 'mock-dev-token-' + Date.now(),
  user: {
    id: 1,
    name: email.split('@')[0] || '开发用户',
    email: email,
    plan: 'pro',  // 改为 'free' / 'basic' / 'enterprise'
    subscription_expiry: new Date(Date.now() + 365 * 24 * 60 * 60 * 1000).toISOString(),
  }
}
```

### 修改模拟弹幕

```typescript
// src/stores/barrage.ts - initMockData()
const mockBarrages = [
  // 在这里添加或修改模拟弹幕数据
  {
    id: 1,
    nickname: '你的用户名',
    content: '你的弹幕内容',
    type: 'text',  // 'text' | 'gift' | 'follow'
    // ...
  }
]
```

---

## 📝 测试步骤

### 完整测试流程

1. **启动应用**
   ```bash
   npm run electron:dev
   ```

2. **查看登录页**
   - ✅ 看到蓝色"开发模式"提示框
   - ✅ 表单正常显示

3. **测试登录**
   - 输入：`test@example.com`
   - 密码：`123456`（任意密码）
   - 点击"登录"

4. **验证结果**
   - ✅ 显示："登录成功（开发模式）"
   - ✅ 自动跳转到 Dashboard
   - ✅ 统计卡片显示：5, 3, 2, 5
   - ✅ 弹幕列表显示 5 条数据
   - ✅ 顶部用户名显示："test"

5. **测试订阅**
   - 点击顶部"订阅状态"
   - ✅ 显示 Pro 套餐信息
   - ✅ 365 天有效期

6. **测试其他功能**
   - 历史记录 ✅
   - 设置页面 ✅
   - 直播监控 ✅

---

## 🌐 生产环境

### 自动切换真实 API

构建生产版本时：

```bash
npm run electron:build
```

所有的 `import.meta.env.DEV` 会自动变为 `false`，代码会自动调用真实的 API：

```typescript
// 自动执行这个分支
const response = await axios.post('http://localhost:8000/api/auth/login', {
  email,
  password,
})
```

### 生产环境配置

生产环境需要：

1. ✅ 配置真实的 API 地址
2. ✅ 部署 Laravel 后端
3. ✅ 配置数据库连接
4. ✅ 设置环境变量

---

## 💡 最佳实践

### 开发时

1. **随意测试** - 任意邮箱密码都能登录
2. **快速迭代** - 无需等待真实 API
3. **专注 UI** - 先完善界面，后对接真实数据
4. **独立开发** - 前后端可以并行开发

### 准备上线时

1. **配置 API 地址** - 修改 axios baseURL
2. **测试真实环境** - 使用 `npm run build` 构建
3. **验证功能** - 确保所有 API 对接正确
4. **部署发布** - 打包分发

---

## 🎉 总结

### 对比总结

**之前**：
```
点击离线模式 → 设置特殊用户 → 特殊判断逻辑 → 显示模拟数据
```

**现在**：
```
输入任意账号密码 → 登录 → 自动返回模拟数据 ✨
```

### 核心优势

🚀 **更简单** - 正常登录即可  
🎯 **更自然** - 无缝开发体验  
🔧 **更灵活** - 轻松修改模拟数据  
✨ **更专业** - 环境自动切换  

---

**© 2025 - 开发模式自动 Mock | 让开发更简单 🚀**

