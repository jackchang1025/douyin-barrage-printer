# å¿«é€Ÿå¼€å§‹æŒ‡å—

æœ¬æŒ‡å—å°†å¸®åŠ©ä½ å¿«é€Ÿæ­å»ºå¹¶è¿è¡ŒæŠ–éŸ³å¼¹å¹•æ‰“å° SaaS ç³»ç»Ÿçš„å¼€å‘ç¯å¢ƒã€‚

## ğŸ¯ å‰ç½®è¦æ±‚

### å®¢æˆ·ç«¯å¼€å‘ç¯å¢ƒ
- **Node.js**: 18.x æˆ–æ›´é«˜ç‰ˆæœ¬
- **npm/pnpm**: æœ€æ–°ç‰ˆæœ¬
- **æ“ä½œç³»ç»Ÿ**: Windows 10+ / macOS 10.15+

### æœåŠ¡ç«¯å¼€å‘ç¯å¢ƒ
- **PHP**: 8.2 æˆ–æ›´é«˜ç‰ˆæœ¬
- **Composer**: 2.x
- **MySQL**: 8.0 æˆ–æ›´é«˜ç‰ˆæœ¬
- **Redis**: 7.x
- **Web æœåŠ¡å™¨**: Nginx / Apache

---

## ğŸš€ æœåŠ¡ç«¯å¿«é€Ÿæ­å»º

### 1. å®‰è£… Laravel

```bash
# åˆ›å»ºé¡¹ç›®
composer create-project laravel/laravel douyin-saas-backend
cd douyin-saas-backend
```

### 2. å®‰è£… FilamentPHP

```bash
# å®‰è£… Filament æ ¸å¿ƒ
composer require filament/filament:"^3.2" -W

# å®‰è£…å®Œæˆåè¿è¡Œ
php artisan filament:install --panels
```

### 3. å®‰è£…å…¶ä»–ä¾èµ–

```bash
# Laravel Sanctum (API è®¤è¯)
composer require laravel/sanctum

# æƒé™ç®¡ç†
composer require spatie/laravel-permission

# æ”¯ä»˜SDK
composer require yansongda/pay
```

### 4. é…ç½®ç¯å¢ƒå˜é‡

ç¼–è¾‘ `.env` æ–‡ä»¶ï¼š

```env
APP_NAME="æŠ–éŸ³å¼¹å¹•æ‰“å°ç³»ç»Ÿ"
APP_URL=http://localhost:8000

DB_CONNECTION=mysql
DB_HOST=127.0.0.1
DB_PORT=3306
DB_DATABASE=douyin_saas
DB_USERNAME=root
DB_PASSWORD=your_password

REDIS_HOST=127.0.0.1
REDIS_PASSWORD=null
REDIS_PORT=6379

# æ”¯ä»˜å®é…ç½®
ALIPAY_APP_ID=your_app_id
ALIPAY_PRIVATE_KEY=your_private_key
ALIPAY_PUBLIC_KEY=alipay_public_key

# å¾®ä¿¡æ”¯ä»˜é…ç½®
WECHAT_APP_ID=your_app_id
WECHAT_MCH_ID=your_mch_id
WECHAT_KEY=your_key
```

### 5. è¿è¡Œæ•°æ®åº“è¿ç§»

```bash
# ç”Ÿæˆåº”ç”¨å¯†é’¥
php artisan key:generate

# å‘å¸ƒ Sanctum é…ç½®
php artisan vendor:publish --provider="Laravel\Sanctum\SanctumServiceProvider"

# è¿è¡Œè¿ç§»
php artisan migrate

# å¡«å……æµ‹è¯•æ•°æ®ï¼ˆå¯é€‰ï¼‰
php artisan db:seed
```

### 6. åˆ›å»ºç®¡ç†å‘˜è´¦å·

```bash
php artisan make:filament-user
```

æŒ‰æç¤ºè¾“å…¥ï¼š
- Name: Admin
- Email: admin@example.com
- Password: æ‚¨çš„å¯†ç 

### 7. å¯åŠ¨æœåŠ¡

```bash
# å¯åŠ¨å¼€å‘æœåŠ¡å™¨
php artisan serve

# æ–°å¼€ä¸€ä¸ªç»ˆç«¯ï¼Œå¯åŠ¨é˜Ÿåˆ—å¤„ç†
php artisan queue:work
```

è®¿é—®ï¼š
- **ç®¡ç†åå°**: http://localhost:8000/admin
- **API åŸºç¡€è·¯å¾„**: http://localhost:8000/api

---

## ğŸ’» å®¢æˆ·ç«¯å¿«é€Ÿæ­å»º

### 1. åˆå§‹åŒ–é¡¹ç›®

```bash
# ä½¿ç”¨ pnpmï¼ˆæ¨èï¼Œé€Ÿåº¦æ›´å¿«ï¼‰
pnpm create vite douyin-barrage-printer --template vue-ts
cd douyin-barrage-printer
```

### 2. å®‰è£…æ ¸å¿ƒä¾èµ–

```bash
# å®‰è£… Vue ç”Ÿæ€ä¾èµ–
pnpm add vue-router@4 pinia element-plus @element-plus/icons-vue axios

# å®‰è£… Electron ç›¸å…³
pnpm add -D electron electron-builder vite-plugin-electron concurrently

# å®‰è£…ç¡¬ä»¶å’Œæ•°æ®åº“ä¾èµ–
pnpm add better-sqlite3 node-escpos escpos-usb protobufjs ws node-machine-id

# å®‰è£…å·¥å…·ä¾èµ–
pnpm add electron-store
```

### 3. é¡¹ç›®ç»“æ„åˆå§‹åŒ–

```bash
# åˆ›å»ºç›®å½•ç»“æ„
mkdir -p electron/{database,printer,douyin,utils}
mkdir -p src/{router,stores,views,components,composables,api}
mkdir proto
```

### 4. é…ç½® Vite

åˆ›å»º `vite.config.ts`ï¼š

```typescript
import { defineConfig } from 'vite'
import vue from '@vitejs/plugin-vue'
import electron from 'vite-plugin-electron'
import { resolve } from 'path'

export default defineConfig({
  plugins: [
    vue(),
    electron([
      {
        entry: 'electron/main.ts',
      },
      {
        entry: 'electron/preload.ts',
        onstart(options) {
          options.reload()
        },
      },
    ]),
  ],
  resolve: {
    alias: {
      '@': resolve(__dirname, 'src'),
    },
  },
})
```

### 5. é…ç½® Element Plus

ç¼–è¾‘ `src/main.ts`ï¼š

```typescript
import { createApp } from 'vue'
import { createPinia } from 'pinia'
import ElementPlus from 'element-plus'
import 'element-plus/dist/index.css'
import * as ElementPlusIconsVue from '@element-plus/icons-vue'
import zhCn from 'element-plus/es/locale/lang/zh-cn'
import App from './App.vue'
import router from './router'

const app = createApp(App)
const pinia = createPinia()

// æ³¨å†Œæ‰€æœ‰å›¾æ ‡
for (const [key, component] of Object.entries(ElementPlusIconsVue)) {
  app.component(key, component)
}

app.use(pinia)
app.use(router)
app.use(ElementPlus, { locale: zhCn })

app.mount('#app')
```

### 6. åˆ›å»ºåŸºç¡€ Electron ä¸»è¿›ç¨‹

åˆ›å»º `electron/main.ts`ï¼š

```typescript
import { app, BrowserWindow } from 'electron'
import path from 'path'

function createWindow() {
  const win = new BrowserWindow({
    width: 1200,
    height: 800,
    webPreferences: {
      preload: path.join(__dirname, 'preload.js'),
      nodeIntegration: false,
      contextIsolation: true,
    },
  })

  if (process.env.VITE_DEV_SERVER_URL) {
    win.loadURL(process.env.VITE_DEV_SERVER_URL)
    win.webContents.openDevTools()
  } else {
    win.loadFile(path.join(__dirname, '../dist/index.html'))
  }
}

app.whenReady().then(createWindow)

app.on('window-all-closed', () => {
  if (process.platform !== 'darwin') {
    app.quit()
  }
})

app.on('activate', () => {
  if (BrowserWindow.getAllWindows().length === 0) {
    createWindow()
  }
})
```

### 7. ä¿®æ”¹ package.json

```json
{
  "name": "douyin-barrage-printer",
  "version": "1.0.0",
  "main": "dist-electron/main.js",
  "scripts": {
    "dev": "vite",
    "build": "vue-tsc && vite build",
    "preview": "vite preview",
    "electron:dev": "vite --mode development",
    "electron:build": "vite build && electron-builder"
  },
  "build": {
    "appId": "com.douyin.barrage.printer",
    "productName": "æŠ–éŸ³å¼¹å¹•æ‰“å°",
    "directories": {
      "output": "release"
    },
    "win": {
      "target": ["nsis"],
      "icon": "build/icon.ico"
    },
    "mac": {
      "target": ["dmg"],
      "icon": "build/icon.icns"
    }
  }
}
```

### 8. å¯åŠ¨å¼€å‘æœåŠ¡å™¨

```bash
pnpm run electron:dev
```

---

## ğŸ”— è¿æ¥å®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯

### é…ç½® API åŸºç¡€åœ°å€

åˆ›å»º `src/api/index.ts`ï¼š

```typescript
import axios from 'axios'
import { ElMessage } from 'element-plus'

const api = axios.create({
  baseURL: 'http://localhost:8000/api',
  timeout: 10000,
})

// è¯·æ±‚æ‹¦æˆªå™¨
api.interceptors.request.use(
  (config) => {
    const token = localStorage.getItem('auth_token')
    if (token) {
      config.headers.Authorization = `Bearer ${token}`
    }
    return config
  },
  (error) => {
    return Promise.reject(error)
  }
)

// å“åº”æ‹¦æˆªå™¨
api.interceptors.response.use(
  (response) => response,
  (error) => {
    if (error.response?.status === 401) {
      ElMessage.error('ç™»å½•å·²è¿‡æœŸï¼Œè¯·é‡æ–°ç™»å½•')
      localStorage.removeItem('auth_token')
      window.location.href = '/login'
    } else {
      ElMessage.error(error.response?.data?.message || 'è¯·æ±‚å¤±è´¥')
    }
    return Promise.reject(error)
  }
)

export default api
```

---

## ğŸ“¦ æ‰“åŒ…å‘å¸ƒ

### å®¢æˆ·ç«¯æ‰“åŒ…

```bash
# Windows æ‰“åŒ…
pnpm run electron:build --win

# macOS æ‰“åŒ…
pnpm run electron:build --mac

# æ‰“åŒ…äº§ç‰©åœ¨ release/ ç›®å½•
```

### æœåŠ¡ç«¯éƒ¨ç½²

```bash
# ç”Ÿäº§ç¯å¢ƒä¼˜åŒ–
composer install --optimize-autoloader --no-dev

# æ¸…é™¤å¹¶ç¼“å­˜é…ç½®
php artisan config:cache
php artisan route:cache
php artisan view:cache

# ä½¿ç”¨ Supervisor ç®¡ç†é˜Ÿåˆ—
sudo supervisorctl start laravel-worker:*
```

---

## ğŸ§ª æµ‹è¯•

### æœåŠ¡ç«¯æµ‹è¯•

```bash
# è¿è¡Œå•å…ƒæµ‹è¯•
php artisan test

# è¿è¡Œç‰¹å®šæµ‹è¯•
php artisan test --filter=AuthTest
```

### å®¢æˆ·ç«¯æµ‹è¯•

```bash
# å®‰è£…æµ‹è¯•ä¾èµ–
pnpm add -D vitest @vue/test-utils

# è¿è¡Œæµ‹è¯•
pnpm run test
```

---

## âš ï¸ å¸¸è§é—®é¢˜

### Q1: better-sqlite3 å®‰è£…å¤±è´¥

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# Windows éœ€è¦å®‰è£…æ„å»ºå·¥å…·
npm install --global --production windows-build-tools

# é‡æ–°å®‰è£…
pnpm add better-sqlite3 --force
```

### Q2: Electron çª—å£ç™½å±

**æ£€æŸ¥**ï¼š
- ç¡®è®¤ Vite å¼€å‘æœåŠ¡å™¨å·²å¯åŠ¨
- æ£€æŸ¥ `electron/main.ts` ä¸­çš„ URL é…ç½®
- æ‰“å¼€å¼€å‘è€…å·¥å…·æŸ¥çœ‹æ§åˆ¶å°é”™è¯¯

### Q3: FilamentPHP åå°æ— æ³•è®¿é—®

**æ£€æŸ¥**ï¼š
- ç¡®è®¤å·²è¿è¡Œ `php artisan filament:install --panels`
- æ£€æŸ¥æ˜¯å¦åˆ›å»ºäº†ç®¡ç†å‘˜è´¦å·
- è®¿é—® `/admin` è·¯å¾„è€Œä¸æ˜¯æ ¹è·¯å¾„

### Q4: æ‰“å°æœºè¿æ¥å¤±è´¥

**è§£å†³æ–¹æ¡ˆ**ï¼š
- ç¡®è®¤æ‰“å°æœºå·²æ­£ç¡®è¿æ¥ USB
- Windows éœ€è¦å®‰è£…æ‰“å°æœºé©±åŠ¨
- æ£€æŸ¥ `node-escpos` æ˜¯å¦æ­£ç¡®è¯†åˆ«è®¾å¤‡

---

## ğŸ“š ä¸‹ä¸€æ­¥

1. é˜…è¯»å®Œæ•´çš„[æŠ€æœ¯æ–‡æ¡£](./æŠ–éŸ³å¼¹å¹•æ‰“å°SaaSç³»ç»ŸæŠ€æœ¯æ–‡æ¡£.md)
2. å®ç°æŠ–éŸ³ç™»å½•åŠŸèƒ½
3. å¼€å‘ WebSocket å¼¹å¹•æŠ“å–
4. é›†æˆæ‰“å°æœºé©±åŠ¨
5. æ¥å…¥æ”¯ä»˜ç³»ç»Ÿ

---

**ç¥ä½ å¼€å‘é¡ºåˆ©ï¼ğŸ‰**

