# 🧪 测试抖音弹幕抓取功能

## 🚀 快速测试流程

### 前提条件

✅ 已登录抖音账号（参见"设置" → "抖音账号"）  
✅ 应用正常运行（`npm run electron:dev`）  
✅ 有一个正在直播的抖音直播间

---

## 📝 测试步骤

### 步骤 1: 启动应用

```bash
npm run electron:dev
```

等待应用启动完成。

---

### 步骤 2: 确认已登录

1. 点击左侧 **"设置"** （齿轮图标）
2. 进入 **"抖音账号"** Tab
3. 确认显示账号信息（昵称、UID）
4. Cookie 状态显示 **"有效"**

如果未登录，请先完成登录：
- 点击"登录抖音账号"
- 扫码或账号密码登录
- 等待登录成功

---

### 步骤 3: 找一个直播间

有几种方式获取直播间链接：

#### 方式 1: 从抖音 APP/网页复制

1. 打开抖音 APP 或网页版
2. 进入任意正在直播的直播间
3. 点击"分享" → "复制链接"
4. 得到类似这样的链接：
   ```
   https://live.douyin.com/123456789
   ```

#### 方式 2: 使用测试直播间

如果没有现成的直播间，可以：
- 在抖音搜索热门主播
- 找一个正在直播的直播间
- 复制链接

---

### 步骤 4: 开始监控

1. 点击左侧 **"直播监控"** 菜单

2. 在 **"直播间链接"** 输入框中粘贴链接
   ```
   例如：https://live.douyin.com/123456789
   或直接输入房间号：123456789
   ```

3. 点击 **"开始监控"** 按钮

4. 等待新窗口打开

应该会：
- ✅ 弹出一个新窗口
- ✅ 自动加载直播间页面
- ✅ 显示"监控已启动"提示
- ✅ 主界面状态变为"监控中"

---

### 步骤 5: 查看效果

#### 5.1 监控窗口（新打开的窗口）

- ✅ 应该能看到直播间正常播放
- ✅ 已自动登录（能看到自己的头像/昵称）
- ✅ 按 **F12** 打开控制台，应该看到：
  ```javascript
  🎯 WebSocket Hook 已注入
  ✅ WebSocket Hook 安装完成
  🔌 WebSocket 连接: wss://...
  ```

#### 5.2 主界面（直播监控页面）

- ✅ 状态显示："监控中: 123456789"
- ✅ 统计信息实时更新：
  - 已收弹幕: 递增
  - 礼物数: 递增（如果有人送礼物）
  - 运行时长: 计时增长

- ✅ **弹幕列表实时滚动**：
  ```
  [头像] 测试用户1: 666！
  [头像] 测试用户2: 送出了嘉年华 [礼物]
  [头像] 测试用户3: 关注了主播 [关注]
  ```

#### 5.3 Terminal 日志（开发工具）

查看 Terminal 窗口，应该看到：

```
🎥 开始监控直播间: https://live.douyin.com/123456789
✅ Cookie 已注入到直播间Session
✅ WebSocket Hook 脚本已注入
✅ 直播间页面加载完成
📨 收到弹幕: 用户A: 666！
📨 收到弹幕: 用户B: 送出了礼物
📨 收到弹幕: 用户C: 进入直播间
...
```

---

### 步骤 6: 停止监控

1. 点击 **"停止监控"** 按钮

2. 应该看到：
   - ✅ 监控窗口自动关闭
   - ✅ 状态变为"未监控"
   - ✅ 计时器停止
   - ✅ 提示："已停止监控"

---

## ✅ 完整测试检查清单

### 功能测试

- [ ] 应用正常启动
- [ ] 抖音账号已登录且有效
- [ ] 可以输入直播间链接
- [ ] 点击"开始监控"打开新窗口
- [ ] 新窗口正常加载直播间
- [ ] 新窗口已自动登录（看到自己头像）
- [ ] F12 控制台显示 WebSocket Hook 日志

### 弹幕接收测试

- [ ] 主界面实时显示弹幕
- [ ] 弹幕包含用户昵称
- [ ] 弹幕包含内容
- [ ] 能识别普通文本弹幕
- [ ] 能识别礼物弹幕（如果有）
- [ ] 弹幕列表自动滚动

### 统计信息测试

- [ ] "已收弹幕"数量递增
- [ ] "礼物数"正确统计（如果有礼物）
- [ ] "运行时长"正常计时

### 停止监控测试

- [ ] 点击"停止监控"正常工作
- [ ] 监控窗口关闭
- [ ] 状态恢复为"未监控"
- [ ] 计时器停止

### 数据持久化测试

- [ ] 进入"历史记录"页面
- [ ] 能看到刚才收到的弹幕
- [ ] 数据已保存到数据库

---

## 🐛 可能遇到的问题

### 问题 1: 点击"开始监控"无反应

**检查**:
```
1. 是否已登录抖音账号？
   → 进入"设置" → "抖音账号"，确认已登录

2. 直播间链接是否正确？
   → 格式：https://live.douyin.com/数字
   → 或直接输入数字房间号

3. 查看 Terminal 日志
   → 是否有错误信息？
```

**解决**:
- 先完成抖音账号登录
- 确认直播间链接格式正确
- 查看错误提示并根据提示操作

---

### 问题 2: 监控窗口打开但空白

**检查**:
```
1. 网络连接是否正常？
   → 尝试在浏览器中访问 www.douyin.com

2. 查看 Terminal 日志
   → 是否有加载失败的错误？
```

**解决**:
- 检查网络连接
- 等待页面完全加载（可能需要10-30秒）
- 刷新监控窗口（F5）

---

### 问题 3: 监控窗口打开但没有弹幕

**这是最常见的情况！**

**可能原因**:
1. ✅ **直播间没有人发弹幕** 
   - 选择一个热门直播间测试
   - 等待有人发弹幕

2. ⚠️ **WebSocket Hook 未正确注入**
   - 按 F12 打开控制台
   - 查看是否有"WebSocket Hook 已注入"日志
   - 如果没有，关闭窗口重新开始监控

3. ⚠️ **抖音数据格式已变化**
   - 在控制台查看是否有 WebSocket 连接日志
   - 查看是否收到数据但解析失败
   - 如果有数据但不显示，可能需要更新解析逻辑

**调试步骤**:

1. **确认 WebSocket 连接**
   ```
   在监控窗口按 F12
   → Console 标签
   → 应该看到：
      🎯 WebSocket Hook 已注入
      🔌 WebSocket 连接: wss://...
   ```

2. **确认收到数据**
   ```
   有人发弹幕时，Console 应该显示：
      📝 收到文本弹幕数据: {...}
   或
      📦 收到二进制弹幕数据: ArrayBuffer
   ```

3. **检查主进程日志**
   ```
   Terminal 窗口应该显示：
      📨 收到弹幕: 用户名: 内容
   ```

---

### 问题 4: 弹幕显示不完整

**症状**: 只显示部分信息，如只有昵称没有内容

**原因**: 抖音的弹幕数据格式可能与预期不同

**解决**:
1. 在监控窗口 F12 控制台查看原始数据
2. 复制完整的数据对象发给我
3. 我会帮您更新解析逻辑

---

### 问题 5: 监控一段时间后崩溃

**原因**: 可能是内存不足（弹幕太多）

**临时解决**:
- 定期停止并重新开始监控
- 清理历史数据

**长期解决**:
- 需要实现弹幕数量限制
- 自动清理旧数据

---

## 📊 成功的标志

当您看到以下所有现象，说明功能完全正常：

✅ **监控窗口**
- 直播间正常播放
- 已自动登录
- F12 控制台有 WebSocket Hook 日志

✅ **主界面**
- 状态显示"监控中"
- 弹幕实时滚动显示
- 统计数据递增

✅ **Terminal 日志**
- 显示"收到弹幕"日志
- 每条弹幕都有日志输出

✅ **数据库**
- 历史记录页面能看到弹幕
- 数据已持久化保存

---

## 🎯 测试建议

### 选择合适的测试直播间

1. **热门主播**
   - 弹幕多，测试效果明显
   - 但数据量大，可能影响性能

2. **中等人气主播**
   - 弹幕频率适中
   - 容易观察单条弹幕
   - **推荐用于测试**

3. **小主播**
   - 弹幕少，需要等待
   - 适合调试单条弹幕逻辑

### 测试不同类型的弹幕

- **文本弹幕**: 普通聊天消息
- **礼物弹幕**: 送礼物时触发
- **关注弹幕**: 新用户进入直播间
- **点赞**: 连续点赞

### 压力测试

找一个超级热门直播间（如：
- 大主播的直播间
- 热门活动直播间

观察：
- 弹幕是否能跟上
- 界面是否卡顿
- 内存占用情况

---

## 📞 获取帮助

如果测试过程中遇到问题：

1. **查看 Terminal 日志**
   - 复制完整的错误信息

2. **查看监控窗口控制台**
   - F12 → Console
   - 复制相关日志

3. **截图或录屏**
   - 展示问题现象

4. **提供信息**
   - 直播间链接
   - 操作步骤
   - 错误日志
   - 截图/录屏

---

## 🎉 测试完成！

如果您成功看到弹幕实时显示，恭喜您！核心功能已经运行成功！🎉

接下来可以：

1. **测试打印功能**（如果打印机已连接）
2. **设置弹幕过滤规则**
3. **自定义打印模板**
4. **监控多个直播间**

---

**祝测试顺利！如有问题随时反馈！🚀**

