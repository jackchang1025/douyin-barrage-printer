# ç¦»çº¿æ¨¡å¼è·³è½¬é—®é¢˜ä¿®å¤

## ğŸ› é—®é¢˜æè¿°

**ç—‡çŠ¶**ï¼šç‚¹å‡»"ç¦»çº¿æ¨¡å¼"æŒ‰é’®åï¼Œæ˜¾ç¤ºæˆåŠŸæç¤ºï¼Œä½†é¡µé¢ä¸è·³è½¬åˆ° Dashboard

**åŸå› **ï¼š
1. `authStore.isAuthenticated` æ˜¯ä¸€ä¸ª refï¼Œç”± watch è‡ªåŠ¨æ›´æ–°
2. watch çš„é€»è¾‘è¦æ±‚ **token å’Œ user éƒ½æœ‰å€¼** æ‰è®¾ç½® isAuthenticated ä¸º true
3. ä¹‹å‰åªè®¾ç½®äº† userï¼Œæ²¡æœ‰è®¾ç½® token

---

## âœ… ä¿®å¤å†…å®¹

### 1. Login.vue - æ·»åŠ  token è®¾ç½®

```typescript
const handleOfflineMode = () => {
  // è®¾ç½®ç¦»çº¿ç”¨æˆ·ä¿¡æ¯
  authStore.user = {
    id: 0,
    name: 'ç¦»çº¿ç”¨æˆ·',
    email: 'offline@local',
    plan: 'free'
  }
  
  // âœ… å…³é”®ä¿®å¤ï¼šè®¾ç½®è™šæ‹Ÿ token
  authStore.token = 'offline-mode-token'
  
  ElMessage.success('å·²è¿›å…¥ç¦»çº¿æ¨¡å¼ï¼Œéƒ¨åˆ†åŠŸèƒ½å—é™')
  
  // ç¡®ä¿çŠ¶æ€æ›´æ–°åå†è·³è½¬
  setTimeout(() => {
    router.push('/dashboard')
  }, 100)
}
```

### 2. router/index.ts - æ·»åŠ è°ƒè¯•æ—¥å¿—

æ·»åŠ äº†è¯¦ç»†çš„è·¯ç”±å®ˆå«æ—¥å¿—ï¼Œæ–¹ä¾¿è°ƒè¯•ï¼š

```typescript
console.log('è·¯ç”±å®ˆå«æ£€æŸ¥:', {
  to: to.name,
  requiresAuth: to.meta.requiresAuth,
  isAuthenticated: authStore.isAuthenticated,
  user: authStore.user
})
```

---

## ğŸ” å·¥ä½œåŸç†

### auth.ts ä¸­çš„ watch é€»è¾‘

```typescript
// å®šä¹‰
const token = ref<string | null>(null)
const user = ref<any>(null)
const isAuthenticated = ref(false)

// watch ç›‘å¬
watch([token, user], () => {
  isAuthenticated.value = !!token.value && !!user.value
}, { immediate: true })
```

**å…³é”®ç‚¹**ï¼š
- âœ… åªæœ‰å½“ `token` **å’Œ** `user` éƒ½æœ‰å€¼æ—¶ï¼Œ`isAuthenticated` æ‰ä¸º `true`
- âœ… watch ä¼šè‡ªåŠ¨è§¦å‘ï¼Œæ— éœ€æ‰‹åŠ¨è®¾ç½® isAuthenticated

### ä¿®å¤åçš„æµç¨‹

```
ç‚¹å‡»ç¦»çº¿æ¨¡å¼æŒ‰é’®
    â†“
è®¾ç½® authStore.user = {...}
    â†“
è®¾ç½® authStore.token = 'offline-mode-token'
    â†“
watch è§¦å‘ï¼šæ£€æµ‹åˆ° token å’Œ user éƒ½æœ‰å€¼
    â†“
è‡ªåŠ¨æ›´æ–°ï¼šisAuthenticated.value = true
    â†“
æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯
    â†“
å»¶è¿Ÿ 100msï¼ˆç¡®ä¿çŠ¶æ€å·²æ›´æ–°ï¼‰
    â†“
router.push('/dashboard')
    â†“
è·¯ç”±å®ˆå«æ£€æŸ¥ï¼šauthStore.isAuthenticated === true
    â†“
å…è®¸è®¿é—®ï¼šnext()
    â†“
âœ… æˆåŠŸè·³è½¬åˆ° Dashboard
```

---

## ğŸ§ª æµ‹è¯•æ­¥éª¤

### 1. åˆ·æ–°åº”ç”¨

å¦‚æœ Electron åº”ç”¨è¿˜åœ¨è¿è¡Œï¼š
- æŒ‰ `Ctrl+R` (Windows) æˆ– `Cmd+R` (Mac) åˆ·æ–°
- æˆ–å…³é—­é‡æ–°å¯åŠ¨ï¼š`npm run electron:dev`

### 2. æŸ¥çœ‹æ§åˆ¶å°

æ‰“å¼€å¼€å‘è€…å·¥å…·ï¼ˆF12ï¼‰ï¼Œåˆ‡æ¢åˆ° Console æ ‡ç­¾

### 3. ç‚¹å‡»ç¦»çº¿æ¨¡å¼

ç‚¹å‡»"ç¦»çº¿æ¨¡å¼ï¼ˆä»…æœ¬åœ°åŠŸèƒ½ï¼‰"æŒ‰é’®

### 4. æŸ¥çœ‹æ—¥å¿—

åº”è¯¥çœ‹åˆ°ä»¥ä¸‹æ—¥å¿—ï¼š

```
è·¯ç”±å®ˆå«æ£€æŸ¥: {
  to: "Dashboard",
  requiresAuth: true,
  isAuthenticated: true,
  user: { id: 0, name: "ç¦»çº¿ç”¨æˆ·", email: "offline@local", plan: "free" }
}
æ”¾è¡Œ
```

### 5. ç¡®è®¤ç»“æœ

âœ… æ˜¾ç¤ºæ¶ˆæ¯ï¼š"å·²è¿›å…¥ç¦»çº¿æ¨¡å¼ï¼Œéƒ¨åˆ†åŠŸèƒ½å—é™"  
âœ… é¡µé¢è·³è½¬åˆ° Dashboard  
âœ… æ˜¾ç¤ºç»Ÿè®¡æ•°æ®å’Œæ¨¡æ‹Ÿå¼¹å¹•  
âœ… é¡¶éƒ¨æ˜¾ç¤ºç”¨æˆ·åï¼š"ç¦»çº¿ç”¨æˆ·"  

---

## ğŸ“Š éªŒè¯æ¸…å•

- [ ] ç‚¹å‡»ç¦»çº¿æ¨¡å¼æŒ‰é’®
- [ ] çœ‹åˆ°æˆåŠŸæç¤ºæ¶ˆæ¯
- [ ] é¡µé¢è‡ªåŠ¨è·³è½¬åˆ° Dashboard
- [ ] Dashboard æ˜¾ç¤ºç»Ÿè®¡å¡ç‰‡ï¼ˆ5, 3, 2, 5ï¼‰
- [ ] æœ€è¿‘å¼¹å¹•åˆ—è¡¨æ˜¾ç¤º 5 æ¡æ•°æ®
- [ ] é¡¶éƒ¨æ˜¾ç¤ºç”¨æˆ·å"ç¦»çº¿ç”¨æˆ·"
- [ ] æ§åˆ¶å°æ²¡æœ‰çº¢è‰²é”™è¯¯
- [ ] è·¯ç”±å®ˆå«æ—¥å¿—æ˜¾ç¤º isAuthenticated: true

---

## ğŸ¯ å…³é”®è¦ç‚¹

### Pinia + Composition API çš„ ref ä½¿ç”¨

åœ¨ **store å†…éƒ¨**ï¼š
```typescript
token.value = 'xxx'  // éœ€è¦ .value
user.value = {...}   // éœ€è¦ .value
```

åœ¨ **ç»„ä»¶ä¸­ä½¿ç”¨**ï¼š
```typescript
authStore.token = 'xxx'  // ä¸éœ€è¦ .valueï¼ˆè‡ªåŠ¨è§£åŒ…ï¼‰
authStore.user = {...}   // ä¸éœ€è¦ .valueï¼ˆè‡ªåŠ¨è§£åŒ…ï¼‰
```

### watch çš„è§¦å‘æ¡ä»¶

```typescript
watch([token, user], () => {
  isAuthenticated.value = !!token.value && !!user.value
}, { immediate: true })
```

- ç›‘å¬æ•°ç»„ `[token, user]`
- ä»»ä¸€å€¼å˜åŒ–éƒ½ä¼šè§¦å‘
- ä½†æ¡ä»¶æ˜¯ `token && user`ï¼Œ**ä¸¤è€…éƒ½éœ€è¦æœ‰å€¼**

---

## ğŸ”§ å¦‚æœè¿˜æ˜¯ä¸å·¥ä½œ

### æ–¹æ³• 1: ç¡¬åˆ·æ–°

- Windows: `Ctrl+Shift+R`
- Mac: `Cmd+Shift+R`

### æ–¹æ³• 2: æ¸…é™¤ç¼“å­˜

```bash
# åœæ­¢åº”ç”¨
Ctrl+C

# åˆ é™¤ dist-electron ç›®å½•
rm -rf dist-electron

# é‡æ–°å¯åŠ¨
npm run electron:dev
```

### æ–¹æ³• 3: æŸ¥çœ‹å®Œæ•´æ—¥å¿—

æ‰“å¼€å¼€å‘è€…å·¥å…·ï¼ˆF12ï¼‰ï¼Œåˆ‡æ¢åˆ° Consoleï¼ŒæŸ¥çœ‹ï¼š
- æ˜¯å¦æœ‰çº¢è‰²é”™è¯¯ï¼Ÿ
- è·¯ç”±å®ˆå«æ—¥å¿—ä¸­ isAuthenticated æ˜¯ true è¿˜æ˜¯ falseï¼Ÿ
- user å¯¹è±¡æ˜¯å¦æ­£ç¡®ï¼Ÿ

### æ–¹æ³• 4: æ‰‹åŠ¨æ£€æŸ¥çŠ¶æ€

åœ¨ Console ä¸­è¾“å…¥ï¼š

```javascript
// æŸ¥çœ‹å½“å‰è®¤è¯çŠ¶æ€
window.__PINIA__?.state?.value?.auth
```

åº”è¯¥çœ‹åˆ°ï¼š
```javascript
{
  token: "offline-mode-token",
  user: { id: 0, name: "ç¦»çº¿ç”¨æˆ·", email: "offline@local", plan: "free" },
  isAuthenticated: true,
  loading: false
}
```

---

## âœ¨ é¢„æœŸç»“æœ

ä¿®å¤åï¼Œç¦»çº¿æ¨¡å¼åº”è¯¥å®Œå…¨æ­£å¸¸å·¥ä½œï¼š

âœ… ç‚¹å‡»æŒ‰é’® â†’ æç¤ºæˆåŠŸ â†’ è‡ªåŠ¨è·³è½¬ â†’ æ˜¾ç¤ºæ•°æ®

**æµ‹è¯•æ—¶é—´**: < 1 ç§’  
**ç”¨æˆ·ä½“éªŒ**: æµç•…æ— æ„ŸçŸ¥  

---

**Â© 2025 - é—®é¢˜ä¿®å¤å®Œæˆ âœ…**

