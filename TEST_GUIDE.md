# å¼¹å¹•è¿‡æ»¤å’Œæ‰“å°æµ‹è¯•æŒ‡å—

## ðŸš€ è¿è¡Œæµ‹è¯•

### 1. å®‰è£…ä¾èµ–ï¼ˆå¦‚æžœè¿˜æ²¡å®‰è£…ï¼‰
```bash
npm install
```

### 2. è¿è¡Œå•å…ƒæµ‹è¯•
```bash
npm run test
```

### 3. è¿è¡Œç‰¹å®šæµ‹è¯•æ–‡ä»¶
```bash
# æµ‹è¯•è¿‡æ»¤è§„åˆ™
npm run test -- src/stores/__tests__/printer.filter.spec.ts

# æµ‹è¯•æ—¶é—´æ ¼å¼
npm run test -- src/stores/__tests__/printer.time.spec.ts
```

## ðŸ“‹ æµ‹è¯•ç”¨ä¾‹è¯´æ˜Ž

### ä¸€ã€æ¶ˆæ¯ç±»åž‹è¿‡æ»¤æµ‹è¯•

**é—®é¢˜**: ç‚¹èµžã€å…³æ³¨ç­‰éžèŠå¤©æ¶ˆæ¯ä¹Ÿè¢«æ‰“å°äº†

**ä¿®å¤**: åœ¨ `shouldPrintBarrage` å‡½æ•°å¼€å¤´æ·»åŠ æ¶ˆæ¯ç±»åž‹æ£€æŸ¥

```typescript
// åªå¤„ç†èŠå¤©æ¶ˆæ¯ï¼ˆchat/textï¼‰ï¼Œè¿‡æ»¤æŽ‰ç‚¹èµžã€å…³æ³¨ã€ç¤¼ç‰©ç­‰
if (barrage.type !== 'chat' && barrage.type !== 'text') {
    console.log('â­ï¸ è¿‡æ»¤: éžèŠå¤©æ¶ˆæ¯', barrage.type)
    return false
}
```

**æµ‹è¯•ç”¨ä¾‹**:
- âœ… èŠå¤©æ¶ˆæ¯ï¼ˆtype: 'chat'ï¼‰ â†’ åº”è¯¥æ‰“å°
- âŒ ç‚¹èµžæ¶ˆæ¯ï¼ˆtype: 'like'ï¼‰ â†’ åº”è¯¥è¢«è¿‡æ»¤
- âŒ å…³æ³¨æ¶ˆæ¯ï¼ˆtype: 'follow'ï¼‰ â†’ åº”è¯¥è¢«è¿‡æ»¤
- âŒ ç¤¼ç‰©æ¶ˆæ¯ï¼ˆtype: 'gift'ï¼‰ â†’ åº”è¯¥è¢«è¿‡æ»¤

### äºŒã€å…³é”®è¯+æ•°å­—æ¨¡å¼æµ‹è¯•

**æ¨¡å¼1: keyword_number** - å…³é”®è¯+æ•°å­— æˆ– çº¯æ•°å­—
```typescript
// æµ‹è¯•ç”¨ä¾‹
'æˆ‘è¦æŠ¢88å·'  â†’ âœ… (å…³é”®è¯+æ•°å­—)
'88'          â†’ âœ… (çº¯æ•°å­—)
'æˆ‘è¦å‚ä¸Ž'    â†’ âŒ (åªæœ‰å…³é”®è¯ï¼Œæ— æ•°å­—)
'æ¥äº†88ä¸ªäºº'  â†’ âŒ (æœ‰æ•°å­—ä½†éžçº¯æ•°å­—ï¼Œä¸”æ— å…³é”®è¯)
```

**æ¨¡å¼2: only_keyword_number** - å¿…é¡»åŒæ—¶åŒ…å«å…³é”®è¯å’Œæ•°å­—
```typescript
'æˆ‘è¦æŠ¢88å·'  â†’ âœ… (åŒæ—¶åŒ…å«)
'æˆ‘è¦å‚ä¸Ž'    â†’ âŒ (åªæœ‰å…³é”®è¯)
'88'          â†’ âŒ (åªæœ‰æ•°å­—)
```

### ä¸‰ã€ä»…å…³é”®è¯æ¨¡å¼æµ‹è¯•

```typescript
å…³é”®è¯: ['æŠ¢', 'è¦', 'å‚ä¸Ž']

'æˆ‘è¦å‚ä¸Ž'    â†’ âœ… (åŒ…å«å…³é”®è¯)
'åŠ æ²¹å•Š'      â†’ âŒ (ä¸åŒ…å«å…³é”®è¯)
```

### å››ã€ä»…æ•°å­—æ¨¡å¼æµ‹è¯•

```typescript
æ•°å­—èŒƒå›´: 0-100

'æˆ‘è¦88å·'    â†’ âœ… (åœ¨èŒƒå›´å†…)
'50'          â†’ âœ… (çº¯æ•°å­—ï¼Œåœ¨èŒƒå›´å†…)
'æˆ‘è¦150å·'   â†’ âŒ (è¶…å‡ºèŒƒå›´)
'åŠ æ²¹'        â†’ âŒ (ä¸åŒ…å«æ•°å­—)
```

### äº”ã€é«˜çº§è¿‡æ»¤é€‰é¡¹æµ‹è¯•

#### 1. æ— ç¯ç‰Œä¸æ‰“å°
```typescript
has_badge: true   â†’ âœ… (æœ‰ç¯ç‰Œ)
has_badge: false  â†’ âŒ (æ— ç¯ç‰Œ)
```

#### 2. é™åˆ¶å‰Xä½æ‰“å°
```typescript
é™åˆ¶: 2ä½

ç¬¬1æ¡ â†’ âœ…
ç¬¬2æ¡ â†’ âœ…
ç¬¬3æ¡ â†’ âŒ (è¶…è¿‡é™åˆ¶)
```

#### 3. æ•°å­—åŽ»é‡
```typescript
åŽ»é‡æ—¶é—´: 5ç§’

'88' (ç¬¬1æ¬¡)  â†’ âœ…
'88' (ç«‹å³)   â†’ âŒ (é‡å¤)
'99' (ä¸åŒ)   â†’ âœ…
```

### å…­ã€æ—¶é—´æ ¼å¼æµ‹è¯•

**é—®é¢˜**: æ—¶é—´æ˜¾ç¤ºä¸º `[15:30]` è€Œä¸æ˜¯ `[2024-12-01 15:30:45]`

**ä¿®å¤**: æ›´æ–° `formatTime` å‡½æ•°

```typescript
// ä¿®å¤å‰
const time = new Date(timestamp).toLocaleTimeString('zh-CN', { 
  hour: '2-digit', 
  minute: '2-digit' 
})

// ä¿®å¤åŽ
const formatTime = (timestamp?: number) => {
    const date = timestamp ? new Date(timestamp) : new Date()
    const year = date.getFullYear()
    const month = String(date.getMonth() + 1).padStart(2, '0')
    const day = String(date.getDate()).padStart(2, '0')
    const hour = String(date.getHours()).padStart(2, '0')
    const minute = String(date.getMinutes()).padStart(2, '0')
    const second = String(date.getSeconds()).padStart(2, '0')
    return `${year}-${month}-${day} ${hour}:${minute}:${second}`
}
```

**æµ‹è¯•ç”¨ä¾‹**:
```typescript
timestamp: 2024-12-01 15:30:45 â†’ '2024-12-01 15:30:45'
timestamp: 2024-01-05 09:08:07 â†’ '2024-01-05 09:08:07'  (æ­£ç¡®è¡¥é›¶)
æ¨¡æ¿æ˜¾ç¤º: `[${time}]` â†’ '[2024-12-01 15:30:45]'
```

## ðŸ§ª æ‰‹åŠ¨æµ‹è¯•æ­¥éª¤

### æ­¥éª¤ 1: æµ‹è¯•æ¶ˆæ¯ç±»åž‹è¿‡æ»¤

1. è¿›å…¥ç›´æ’­é—´ç›‘æŽ§é¡µé¢
2. é…ç½®è¿‡æ»¤è§„åˆ™ä¸º"å…¨éƒ¨æ‰“å°"
3. å¼€å§‹ç›‘æŽ§ä¸€ä¸ªæ´»è·ƒç›´æ’­é—´
4. è§‚å¯Ÿå³ä¾§å¼¹å¹•åˆ—è¡¨ï¼Œåº”è¯¥çœ‹åˆ°ï¼š
   - âœ… èŠå¤©å¼¹å¹•æ­£å¸¸æ˜¾ç¤º
   - âœ… ç‚¹èµžã€å…³æ³¨ç­‰æ˜¾ç¤ºåœ¨åº•éƒ¨é€šçŸ¥æ ï¼ˆä¸åœ¨å¼¹å¹•åˆ—è¡¨ä¸­ï¼‰
5. æ£€æŸ¥æ‰“å°æœºï¼Œåº”è¯¥ï¼š
   - âœ… åªæ‰“å°èŠå¤©å¼¹å¹•
   - âŒ ä¸æ‰“å°ç‚¹èµžã€å…³æ³¨ç­‰æ¶ˆæ¯

### æ­¥éª¤ 2: æµ‹è¯•ä»…æ•°å­—æ¨¡å¼

1. é…ç½®è¿‡æ»¤è§„åˆ™ï¼š
   - æ¨¡å¼ï¼šä»…æ•°å­—
   - æ•°å­—èŒƒå›´ï¼š0-100
2. åœ¨ç›´æ’­é—´å‘é€æµ‹è¯•å¼¹å¹•ï¼š
   - "88" â†’ åº”è¯¥æ‰“å°
   - "æˆ‘è¦88å·" â†’ åº”è¯¥æ‰“å°
   - "150" â†’ ä¸åº”è¯¥æ‰“å°ï¼ˆè¶…å‡ºèŒƒå›´ï¼‰
   - "åŠ æ²¹" â†’ ä¸åº”è¯¥æ‰“å°ï¼ˆæ— æ•°å­—ï¼‰

### æ­¥éª¤ 3: æµ‹è¯•æ—¶é—´æ ¼å¼

1. é…ç½®æ‰“å°æ¨¡æ¿ï¼Œæ·»åŠ "æ—¶é—´"å­—æ®µ
2. æ‰“å°æµ‹è¯•é¡µ
3. æ£€æŸ¥æ‰“å°å‡ºçš„æ—¶é—´æ ¼å¼ï¼š
   - âœ… åº”è¯¥æ˜¯ï¼š`[2024-12-01 15:30:45]`
   - âŒ ä¸åº”è¯¥æ˜¯ï¼š`[15:30]`

### æ­¥éª¤ 4: æµ‹è¯•æ•°å­—åŽ»é‡

1. é…ç½®è¿‡æ»¤è§„åˆ™ï¼š
   - æ¨¡å¼ï¼šä»…æ•°å­—
   - æ•°å­—åŽ»é‡ï¼š5ç§’
2. å¿«é€Ÿå‘é€å¤šæ¡ç›¸åŒæ•°å­—çš„å¼¹å¹•ï¼š
   - "88" (ç¬¬1æ¬¡) â†’ åº”è¯¥æ‰“å°
   - "88" (ç¬¬2æ¬¡ï¼Œç«‹å³) â†’ ä¸åº”è¯¥æ‰“å°
   - ç­‰å¾…6ç§’åŽå†å‘ "88" â†’ åº”è¯¥æ‰“å°

### æ­¥éª¤ 5: æµ‹è¯•æ‰“å°é™åˆ¶

1. é…ç½®è¿‡æ»¤è§„åˆ™ï¼š
   - æ¨¡å¼ï¼šå…¨éƒ¨æ‰“å°
   - é™åˆ¶å‰ 3 ä½æ‰“å°
2. é‡ç½®è®¡æ•°å™¨
3. å‘é€å¤šæ¡å¼¹å¹•ï¼Œåªæœ‰å‰3æ¡åº”è¯¥æ‰“å°
4. ç‚¹å‡»"é‡ç½®è®¡æ•°"æŒ‰é’®åŽï¼Œé‡æ–°è®¡æ•°

## ðŸ› é—®é¢˜æŽ’æŸ¥

### é—®é¢˜1: ç‚¹èµžæ¶ˆæ¯ä»ç„¶è¢«æ‰“å°

**æ£€æŸ¥é¡¹**:
1. ç¡®è®¤ `src/stores/printer.ts` ä¸­çš„ `shouldPrintBarrage` å‡½æ•°å·²æ·»åŠ ç±»åž‹æ£€æŸ¥
2. æŸ¥çœ‹æŽ§åˆ¶å°æ—¥å¿—ï¼Œåº”è¯¥çœ‹åˆ°ï¼š`â­ï¸ è¿‡æ»¤: éžèŠå¤©æ¶ˆæ¯ like`
3. ç¡®è®¤ `LiveRoom.vue` ä¸­ä¼ é€’çš„ `type` å­—æ®µæ­£ç¡®

**è°ƒè¯•ä»£ç **:
```typescript
// åœ¨ shouldPrintBarrage å¼€å¤´æ·»åŠ 
console.log('æ£€æŸ¥å¼¹å¹•:', {
  type: barrage.type,
  content: barrage.content,
  nickname: barrage.nickname
})
```

### é—®é¢˜2: æ—¶é—´æ ¼å¼ä»ç„¶æ˜¯ HH:mm

**æ£€æŸ¥é¡¹**:
1. ç¡®è®¤ `electron/printer/printer-service.ts` ä¸­ä¸¤å¤„ `formatTime` å‡½æ•°éƒ½å·²æ›´æ–°
2. é‡å¯ Electron åº”ç”¨ï¼ˆç¡®ä¿åŽç«¯ä»£ç å·²é‡æ–°åŠ è½½ï¼‰
3. æ¸…é™¤ç¼“å­˜å¹¶é‡æ–°æž„å»º

**è°ƒè¯•ä»£ç **:
```typescript
// åœ¨ printBarrageWithTemplate ä¸­æ·»åŠ 
console.log('æ—¶é—´æ ¼å¼:', {
  timestamp: barrage.timestamp,
  formattedTime: time
})
```

### é—®é¢˜3: æ•°å­—èŒƒå›´è¿‡æ»¤ä¸ç”Ÿæ•ˆ

**æ£€æŸ¥é¡¹**:
1. ç¡®è®¤è¿‡æ»¤æ¨¡å¼é€‰æ‹©çš„æ˜¯ "ä»…æ•°å­—"
2. ç¡®è®¤æ•°å­—èŒƒå›´å·²æ­£ç¡®è®¾ç½®ï¼ˆmin: 0, max: 100ï¼‰
3. æŸ¥çœ‹æŽ§åˆ¶å°æ—¥å¿—

**è°ƒè¯•ä»£ç **:
```typescript
// åœ¨ isNumberInRange å‡½æ•°ä¸­æ·»åŠ 
console.log('æ•°å­—èŒƒå›´æ£€æŸ¥:', {
  numbers: numbers,
  min: min,
  max: max,
  inRange: numbers.some(num => {
    const numValue = parseInt(num, 10)
    return !isNaN(numValue) && numValue >= min && numValue <= max
  })
})
```

## ðŸ“Š é¢„æœŸæµ‹è¯•ç»“æžœ

è¿è¡Œæ‰€æœ‰æµ‹è¯•åŽï¼Œåº”è¯¥çœ‹åˆ°ï¼š

```bash
âœ“ æ¶ˆæ¯ç±»åž‹è¿‡æ»¤æµ‹è¯• (4)
  âœ“ åº”è¯¥åªæ‰“å°èŠå¤©æ¶ˆæ¯ï¼Œè¿‡æ»¤æŽ‰ç‚¹èµžã€å…³æ³¨ç­‰

âœ“ å…³é”®è¯+æ•°å­—æ¨¡å¼æµ‹è¯• (8)
  âœ“ å…³é”®è¯+æ•°å­—æˆ–çº¯æ•°å­— - åº”è¯¥æ­£ç¡®è¿‡æ»¤
  âœ“ ä»…å…³é”®è¯+æ•°å­— - å¿…é¡»åŒæ—¶åŒ…å«

âœ“ ä»…å…³é”®è¯æ¨¡å¼æµ‹è¯• (2)
  âœ“ åŒ…å«ä»»æ„å…³é”®è¯å°±æ‰“å°

âœ“ ä»…æ•°å­—æ¨¡å¼æµ‹è¯• (4)
  âœ“ åŒ…å«æ•°å­—ä¸”åœ¨èŒƒå›´å†…å°±æ‰“å°

âœ“ é«˜çº§è¿‡æ»¤é€‰é¡¹æµ‹è¯• (6)
  âœ“ æ— ç¯ç‰Œä¸æ‰“å°
  âœ“ é™åˆ¶å‰Xä½æ‰“å°
  âœ“ æ•°å­—åŽ»é‡

âœ“ å…¨éƒ¨æ‰“å°æ¨¡å¼æµ‹è¯• (3)
  âœ“ åº”è¯¥æ‰“å°æ‰€æœ‰èŠå¤©æ¶ˆæ¯

âœ“ æ—¶é—´æ ¼å¼åŒ–æµ‹è¯• (4)
  âœ“ åº”è¯¥æ ¼å¼åŒ–ä¸º å¹´-æœˆ-æ—¥ æ—¶:åˆ†:ç§’
  âœ“ åº”è¯¥æ­£ç¡®è¡¥é›¶
  âœ“ æ²¡æœ‰ä¼ å…¥æ—¶é—´æˆ³æ—¶åº”è¯¥ä½¿ç”¨å½“å‰æ—¶é—´
  âœ“ åœ¨æ¨¡æ¿ä¸­åº”è¯¥æ˜¾ç¤ºä¸º [å¹´-æœˆ-æ—¥ æ—¶:åˆ†:ç§’]

Test Files  2 passed (2)
     Tests  31 passed (31)
```

## âœ… éªŒæ”¶æ ‡å‡†

### åŠŸèƒ½éªŒæ”¶

1. **æ¶ˆæ¯ç±»åž‹è¿‡æ»¤**
   - [ ] åªæ‰“å°èŠå¤©æ¶ˆæ¯ï¼ˆchat/textï¼‰
   - [ ] ç‚¹èµžæ¶ˆæ¯ä¸æ‰“å°
   - [ ] å…³æ³¨æ¶ˆæ¯ä¸æ‰“å°
   - [ ] ç¤¼ç‰©æ¶ˆæ¯ä¸æ‰“å°

2. **è¿‡æ»¤æ¨¡å¼**
   - [ ] å…³é”®è¯+æ•°å­—æ¨¡å¼æ­£ç¡®å·¥ä½œ
   - [ ] ä»…å…³é”®è¯æ¨¡å¼æ­£ç¡®å·¥ä½œ
   - [ ] ä»…æ•°å­—æ¨¡å¼æ­£ç¡®å·¥ä½œ
   - [ ] æ•°å­—èŒƒå›´è¿‡æ»¤æ­£ç¡®å·¥ä½œ
   - [ ] å…¨éƒ¨æ‰“å°æ¨¡å¼æ­£ç¡®å·¥ä½œ

3. **é«˜çº§é€‰é¡¹**
   - [ ] æ— ç¯ç‰Œä¸æ‰“å°åŠŸèƒ½æ­£ç¡®
   - [ ] æ‰“å°æ•°é‡é™åˆ¶åŠŸèƒ½æ­£ç¡®
   - [ ] æ•°å­—åŽ»é‡åŠŸèƒ½æ­£ç¡®

4. **æ—¶é—´æ ¼å¼**
   - [ ] æ‰“å°æ—¶é—´æ ¼å¼ä¸ºï¼šå¹´-æœˆ-æ—¥ æ—¶:åˆ†:ç§’
   - [ ] æ—¶é—´æ˜¾ç¤ºæ­£ç¡®ï¼ˆä¸æ˜¯æµ‹è¯•æ—¶é—´ï¼‰

### æ€§èƒ½éªŒæ”¶

1. **å“åº”é€Ÿåº¦**
   - [ ] å¼¹å¹•è¿‡æ»¤å»¶è¿Ÿ < 100ms
   - [ ] æ‰“å°å»¶è¿Ÿ < 500ms

2. **èµ„æºå ç”¨**
   - [ ] å†…å­˜å ç”¨ç¨³å®šï¼ˆä¸æŒç»­å¢žé•¿ï¼‰
   - [ ] CPU å ç”¨æ­£å¸¸ï¼ˆ< 30%ï¼‰

## ðŸ“ ä¿®æ”¹è®°å½•

### 2024-12-01

1. **æ·»åŠ æ¶ˆæ¯ç±»åž‹è¿‡æ»¤**
   - ä½ç½®: `src/stores/printer.ts` â†’ `shouldPrintBarrage()`
   - ä¿®æ”¹: æ·»åŠ  `type` æ£€æŸ¥ï¼Œåªå¤„ç† chat/text ç±»åž‹æ¶ˆæ¯

2. **ä¿®å¤æ—¶é—´æ ¼å¼**
   - ä½ç½®: `electron/printer/printer-service.ts`
   - ä¿®æ”¹: ä¸¤å¤„ `formatTime` å‡½æ•°ï¼Œæ”¹ä¸ºå®Œæ•´æ—¥æœŸæ—¶é—´æ ¼å¼

3. **æ·»åŠ å•å…ƒæµ‹è¯•**
   - æ–‡ä»¶: `src/stores/__tests__/printer.filter.spec.ts`
   - æ–‡ä»¶: `src/stores/__tests__/printer.time.spec.ts`
   - è¦†ç›–: æ‰€æœ‰è¿‡æ»¤è§„åˆ™å’Œæ—¶é—´æ ¼å¼åŒ–

4. **å®Œå–„æµ‹è¯•æ–‡æ¡£**
   - æ–‡ä»¶: `TEST_GUIDE.md`
   - å†…å®¹: æµ‹è¯•æ­¥éª¤ã€é¢„æœŸç»“æžœã€é—®é¢˜æŽ’æŸ¥

